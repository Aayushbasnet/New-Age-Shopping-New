{% extends 'main_app/base.html' %}
{% load static %}

{% block title %}Payment{% endblock  %}

{% block content %}

{% comment %} <div class="container py-5 border">
    <!-- Title -->
    <div class="row mb-4">
        <div class="col-lg-8 mx-auto text-center">
            <h1 class="display-6">Make Your Payment</h1>
        </div>
    </div>
    <!-- End -->

    <div class="row">
        <div class="col-lg-6 mx-auto">
            <div class="card ">
                <div class="card-header">
                    <div class="bg-primary shadow-sm pt-4 pl-2 pr-2 pb-2">
                        <!-- Credit card form tabs -->
                        <ul role="tablist" class="nav  text-white rounded nav-fill mb-3">
                            <li class="nav-item"> <i class="fas fa-credit-card mr-2"></i> Credit Card </li>
                        </ul>
                    </div>
                    <!-- End -->

                    <!-- Credit card form content -->
                    <!-- credit card info-->
                    <div id="credit-card" class="tab-pane fade show active pt-3">
                        <form role="form" onsubmit="event.preventDefault()">
                            <div class="form-group"> <label for="cardNumber">
                                    <h6>Card number</h6>
                                </label>
                                <div class="input-group"> <input type="text" name="cardNumber"
                                        placeholder="Valid card number" class="form-control " required>
                                    <div class="input-group-append"> <span class="input-group-text text-muted"> <i
                                                class="fab fa-cc-visa mx-1"></i> <i
                                                class="fab fa-cc-mastercard mx-1"></i> <i
                                                class="fab fa-cc-amex mx-1"></i> </span> </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-sm-8">
                                    <div class="form-group"> <label><span class="hidden-xs">
                                                <h6>Expiration Date</h6>
                                            </span></label>
                                        <div class="input-group"> <input type="number" placeholder="MM" name=""
                                                class="form-control" required> <input type="number" placeholder="YY"
                                                name="" class="form-control" required> </div>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <div class="form-group mb-4"> <label data-toggle="tooltip"
                                            title="Three digit CV code on the back of your card">
                                            <h6>CVV <i class="fa fa-question-circle d-inline"></i></h6>
                                        </label> <input type="text" required class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button type="button" class="subscribe btn btn-primary btn-block shadow-sm"> Confirm
                                    Payment </button>
                                <div>
                        </form>
                    </div>
                    <!-- End -->
                </div>
            </div>
        </div>
    </div>
</div>
</div>
</div> {% endcomment %}

<!--Payment integrations-->
<div class="container py-5 border text-center">
     <!-- Set up a container element for the button -->
    <div id="paypal-button-container"></div>

    <!-- Include the PayPal JavaScript SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=test&currency=USD"></script>

    <script>
        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({

            // Call your server to set up the transaction
            createOrder: function(data, actions) {
                return fetch('/demo/checkout/api/paypal/order/create/', {
                    method: 'post'
                }).then(function(res) {
                    return res.json();
                }).then(function(orderData) {
                    return orderData.id;
                });
            },

            // Call your server to finalize the transaction
            onApprove: function(data, actions) {
                return fetch('/demo/checkout/api/paypal/order/' + data.orderID + '/capture/', {
                    method: 'post'
                }).then(function(res) {
                    return res.json();
                }).then(function(orderData) {
                    // Three cases to handle:
                    //   (1) Recoverable INSTRUMENT_DECLINED -> call actions.restart()
                    //   (2) Other non-recoverable errors -> Show a failure message
                    //   (3) Successful transaction -> Show confirmation or thank you

                    // This example reads a v2/checkout/orders capture response, propagated from the server
                    // You could use a different API or structure for your 'orderData'
                    var errorDetail = Array.isArray(orderData.details) && orderData.details[0];

                    if (errorDetail && errorDetail.issue === 'INSTRUMENT_DECLINED') {
                        return actions.restart(); // Recoverable state, per:
                        // https://developer.paypal.com/docs/checkout/integration-features/funding-failure/
                    }

                    if (errorDetail) {
                        var msg = 'Sorry, your transaction could not be processed.';
                        if (errorDetail.description) msg += '\n\n' + errorDetail.description;
                        if (orderData.debug_id) msg += ' (' + orderData.debug_id + ')';
                        return alert(msg); // Show a failure message (try to avoid alerts in production environments)
                    }

                    // Successful capture! For demo purposes:
                    console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                    var transaction = orderData.purchase_units[0].payments.captures[0];
                    alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');

                    // Replace the above to show a success message within this page, e.g.
                    // const element = document.getElementById('paypal-button-container');
                    // element.innerHTML = '';
                    // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                    // Or go to another URL:  actions.redirect('thank_you.html');
                });
            }

        }).render('#paypal-button-container');
    </script>
</div>

<!--Item totals-->
<div class="container mt-4 border">
    <div class="col-12">
    <h3 class="text-center p-3 text-muted">Ordered Items</h3>
        <table class="table">
            <thead>
                <tr>
                <th scope="col">#</th>
                <th scope="col">Item name</th>
                <th scope="col">Quantity</th>
                <th scope="col">Price</th>
                </tr>
            </thead>
            <tbody>
                {% for order_item in ordered_items %}
                    <tr>
                    <th scope="row">{{forloop.counter}}</th>
                    <td>{{order_item.product.product_name}}</td>
                    <td>{{order_item.quantity}}</td>
                    <td>Rs. {{order_item.get_total}}</td>
                    </tr>
                    <tr>
                {% endfor %}
                <tr>
                    <th scope="row"></th>
                    <td><h5 style="text-decoration: underline;">TOTAL: 
                        </h5>
                    </td>
                    <td></td>
                    <td style="font-weight: bold;"> Rs. {{grand_total}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>



{% endblock content %}